# åŸå‹æ¨¡å¼
>åŸå‹æ¨¡å¼ç®€å•æ¥è¯´å°±æ˜¯ä½¿ç”¨Objectç±»çš„clone()æ–¹æ³•æ¥å¤åˆ¶ä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚

## åŸå‹æ¨¡å¼æ€æƒ³
éå¸¸ç®€å•ï¼Œåœ¨å®ç°ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œå®ç°ä¸€ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•å»åˆ›å»ºä¸€ä¸ªå’Œè¿™ä¸ªå¯¹è±¡å®Œå…¨ä¸€æ ·çš„æ–°çš„å¯¹è±¡ã€‚

å¤§æ¦‚å°±æ˜¯è¿™ä¸ªä¸œè¥¿ã€‚
```java
public class Bean implements Cloneable{
    
    private String name;
    private int id;

    @Override
    protected Object clone() throws CloneNotSupportedException {
        return super.clone();
    }
}
```

å½“ç„¶ç€è¿™ä¸ªä¹Ÿä¸æ˜¯è¯´éå¾—å®ç°Cloneableæ¥å£ï¼Œç„¶åè°ƒç”¨clone()æ–¹æ³•ï¼Œä½†æ˜¯è¿™æ ·å®ç°ä¼šæ¯”è¾ƒç®€å•ï¼Œå‡ è¡Œä»£ç å°±æå®šäº†ã€‚

ä½†æ˜¯è¿™ä¸ªé‡Œé¢å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚

## æµ…æ‹·è´ä¸æ·±æ‹·è´çš„é—®é¢˜
é¦–å…ˆè¯´æ˜ä»€ä¹ˆæ˜¯æ·±æ‹·è´ï¼Œä»€ä¹ˆæ˜¯æµ…æ‹·è´ã€‚

ä¸ªäººæ„Ÿè§‰è¿™ä¸¤ä¸ªä¸œè¥¿ä¸»è¦é’ˆå¯¹çš„å°±æ˜¯å¯¹è±¡ç±»å‹ã€‚

æµ…æ‹·è´å°±æ˜¯åœ¨å¤åˆ¶çš„æ—¶å€™ï¼Œå¦‚æœæ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œé‚£å°±å°†å€¼ç»™è¿‡å»ï¼›å¦‚æœæ˜¯å¼•ç”¨æ•°æ®ç±»å‹é‚£ä¹ˆå°±å°†å†…å­˜çš„æŒ‡å‘ç»™è¿‡å»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŸæ¥çš„å¯¹è±¡å’Œå¤åˆ¶çš„å¯¹è±¡å…¶æŒ‡å‘æ˜¯ç›¸åŒçš„ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªè¿›è¡Œäº†ä¿®æ”¹ï¼Œä¸¤ä¸ªéƒ½ä¼šå—åˆ°å½±å“ã€‚

æ·±æ‹·è´å°±æ˜¯ï¼Œå°†å¼•ç”¨æ•°æ®ç±»å‹é‡æ–°åˆ›å»ºä¸€ä¸ªï¼Œç„¶åå°†å¼•ç”¨äº¤ç»™æ–°çš„å¯¹è±¡ã€‚æ–°äº§ç”Ÿçš„å¯¹è±¡å’ŒåŸæœ¬çš„é™¤äº†æ•°æ®æ˜¯ç›¸åŒçš„ï¼Œå…¶ä»–å¹¶æ²¡æœ‰ä»»ä½•çš„å…³è”ï¼Œå¯¹å…¶ä¸­ä¸€ä¸ªè¿›è¡Œä¿®æ”¹å¹¶ä¸ä¼šå½±å“å¦ä¸€ä¸ªã€‚

åœ¨ä½¿ç”¨`clone()`æ–¹æ³•å¤åˆ¶å¯¹è±¡çš„æ—¶å€™ï¼Œå¦‚æœè¿™ä¸ªå¯¹è±¡ä¸­çš„å±æ€§éƒ½æ˜¯åŸºæœ¬æ•°æ®ç±»å‹çš„è¯ï¼Œå®Œå…¨ğŸ†—æ²¡æœ‰ä»»ä½•çš„é—®é¢˜ï¼Œä½†æ˜¯ä¸€æ—¦å‡ºç°å¼•ç”¨æ•°æ®ç±»å‹çš„æ—¶å€™å°±æœ‰é—®é¢˜äº†ã€‚

çœ‹ä»¥ä¸‹çš„ä»£ç ï¼š

```java
public class Bean implements Cloneable{

    private String name;
    private int id;
    private Bean next;
    
    @Override
    protected Object clone() {
        try {
            return super.clone();
        }catch (Exception e) {
            e.printStackTrace();
        }

        return null;
    }
}
```

```java
    public static void main(String[] args) {
        Bean bean1 = new Bean("B1", 1, null);
        Bean bean2 = new Bean("B2", 2, bean1);

        Bean bean3 = (Bean) bean2.clone();

        System.out.println("bean1: " + bean1.toString());
        System.out.println("bean2: " + bean2.toString() + "\t " + bean2.getNext().toString());
        System.out.println("bean3: " + bean3.toString() + "\t " + bean3.getNext().toString());
    }
```
è¾“å‡ºä¸ºä»¥ä¸‹çš„ç»“æœï¼š
>bean1: prototype.Bean@1b6d3586
bean2: prototype.Bean@4554617c	 prototype.Bean@1b6d3586
bean3: prototype.Bean@74a14482	 prototype.Bean@1b6d3586

å¾ˆæ˜¾ç„¶ï¼Œå¯¹äºå…¶å¼•ç”¨æ•°æ®ç±»å‹åªæ˜¯å°†å¼•ç”¨å¤åˆ¶è¿‡å»äº†ï¼Œå…¶å†…å­˜æŒ‡å‘è¿˜æ˜¯ç›¸åŒçš„ã€‚

é—®é¢˜è§£å†³èµ·æ¥éå¸¸ç®€å•ï¼Œå°†è¿™ä¸ªå¼•ç”¨å¯¹è±¡ä¹Ÿå¤åˆ¶ä¸€ä»½å°±å¯ä»¥äº†ã€‚

## ä¸¤ç§å®ç°æ–¹æ³•
ä¸€ç§è¿˜æ˜¯ä¸Šé¢æ‰€è¯´çš„ï¼Œé‡å†™`clone()`æ–¹æ³•ï¼Œå®ç°å¯¹è±¡çš„å¤åˆ¶ï¼›å¦ä¸€ç§åˆ™æ˜¯ä½¿ç”¨åºåˆ—åŒ–ä¸ååºåˆ—åŒ–æ¥å®ç°å¤åˆ¶ã€‚

ç„¶åæ¨èä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•æ¥å®ç°ï¼Œä¹Ÿå°±æ˜¯åºåˆ—åŒ–ååºåˆ—åŒ–ã€‚


è¿™ä¸ªæ–¹æ³•éœ€è¦å®ç°æ¥å£`Cloneable`ã€‚
```java
    @Override
    public Object clone() {
        Bean bean = null;

        try {
            bean = (Bean) super.clone();
            if (next != null) {
                bean.setNext((Bean) next.clone());
            }
        }catch (Exception e) {
            e.printStackTrace();
        }

        return bean;
    }
```
è¿™ä¸ªéœ€è¦å®ç°æ¥å£`Serializable`ã€‚
```java
    public Bean clone() {
        ByteArrayOutputStream bos = null;
        ObjectOutputStream oos = null;

        ByteArrayInputStream bis = null;
        ObjectInputStream ois = null;

        Bean bean = null;

        try {
            bos = new ByteArrayOutputStream();
            oos = new ObjectOutputStream(bos);

            oos.writeObject(this);

            bis = new ByteArrayInputStream(bos.toByteArray());
            ois = new ObjectInputStream(bis);
            bean = (Bean) ois.readObject();

        } catch (IOException | ClassNotFoundException e) {
            e.printStackTrace();
        }finally {
            try {
                ois.close();
                bis.close();
                oos.close();
                bos.close();
            } catch (IOException e) {
                e.printStackTrace();
            }
        }

        return bean;
    }
```
è‡³äºä¸ºå•¥æ›´åŠ æ¨èä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•å®ç°æˆ‘å¤§è‡´åšäº†ä¸ªæ¨æµ‹ï¼šå¦‚æœä¸¤ä¸ªå¯¹è±¡ä¹‹é—´ç›¸äº’å¼•ç”¨ä¼šå¯¼è‡´ç¬¬ä¸€ç§æ–¹æ³•ç›¸äº’è°ƒç”¨ï¼Œæ— é™å¥—å¨ƒï¼Œç„¶åå†…å­˜æº¢å‡ºï¼Œå®é™…ä¸Šä¹Ÿçš„ç¡®æ˜¯è¿™æ ·ï¼Œå¯ä»¥çœ‹ä¸‹é¢è¿™ä¸ªï¼š

```java
    public static void main(String[] args) {
        Bean bean1 = new Bean("B1", 1, null);
        Bean bean2 = new Bean("B2", 2, bean1);

        bean1.setNext(bean2);

        Bean bean3 = (Bean) bean2.clone();
        System.out.println("bean1: " + bean1.toString());
        System.out.println("bean2: " + bean2.toString() + "\t " + bean2.getNext().toString());
        System.out.println("bean3: " + bean3.toString() + "\t " + bean3.getNext().toString());
    }
```
æœ€åå‡ºç°è¿™ä¸ªé”™è¯¯ï¼šæ ˆæº¢å‡º
>Exception in thread "main" java.lang.StackOverflowError
	at prototype.Bean.clone(Bean.java:50)
	at prototype.Bean.clone(Bean.java:52)

ä½†æ˜¯å¦‚æœä½¿ç”¨åºåˆ—åŒ–çš„æ–¹æ³•å»å®ç°ï¼Œå°±å¯ä»¥æˆåŠŸå¤åˆ¶ã€‚